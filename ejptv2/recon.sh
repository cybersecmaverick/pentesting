#!/bin/bash

############################################################################################################################
# Author: CyberSecMaverick
# Date: 01-12-2023
#
# Description:
# This reconnaissance script automates a comprehensive network sweep using fping, arp-scan, netdiscover, and various Nmap scans.
# It allows both command line and interactive input for flexibility.
# The results are organized into a directory named after the specified Network Name, containing detailed scan outputs.
#
# Usage:
# 1. Run the script interactively or provide IP and Network Name (e.g. internal or DMZ) as command line arguments.
# 2. If using command line arguments:
#    - Syntax: ./recon.sh <IP> <Network Name>
# 3. If using interactive input:
#    - Enter the IP address and Network Name when prompted.
# 4. The script performs a ping sweep, ARP scan, netdiscover, Nmap ping scan, Nmap list scan, all ports scan, quick TCP scan,
#    aggressive TCP scan, fast UDP scan, and version/script UDP scan.
# 5. Results are saved in a directory named after the specified Network Name.
############################################################################################################################


# Check if command line arguments are provided
if [ "$#" -eq 2 ]; then
    ip="$1"
    netid="$2"
elif [ "$#" -eq 1 ]; then
    # Read IPs from input file
    input_file="$1"
    netid="$2"
    # Add your logic here to read IPs from the file into the 'ip' variable
    ip=$(cat "$input_file")
else
    # Interactive input if no command line arguments are provided
    read -p "Enter IP address: " ip
    read -p "Enter Network ID: " netid
fi

# Create a folder for the netid
mkdir -p "$netid"
cd "$netid"

# Echo status and run fping
echo "Performing Fping Ping Sweep..."
fping -a -g "$ip" 2>/dev/null | tee fping.txt

# Echo status and run arp-scan
echo "Performing Arp-Scan Sweep..."
arp-scan --localnet | tee arp-scan.txt

# Echo status and run netdiscover
echo "Performing Nettdiscover..."
netdiscover -r $ip -P | tee netdiscover.txt

# Echo status and run Nmap Ping Scan
echo "Performing Nmap Ping Scan..."
nmap -sn "$ip" -oN "nmap_ping_scan_network_$netid"

# Echo status and run Nmap List Scan
echo "Performing Nmap List Scan..."
nmap -sL "$ip" -oN "nmap_list_scan_$netid"

# Echo status and run Scan all ports
echo "Performing Scan all ports..."
nmap -p- -v -n -Pn --open -T4 "$ip" -oN "nmap_all_ports_$netid"
# Store discovered ports in a variable
ports=$(grep ^[0-9] "nmap_all_ports_$netid" | cut -d '/' -f 1 | tr '\n' ',' | sed 's/,$//')

# Echo status and run Nmap Quick TCP Scan
echo "Performing Nmap Quick TCP Scan..."
nmap "$ip" -oN "nmap_quick_$netid"

# Echo status and run Nmap Aggressive TCP Scan
echo "Performing Nmap Aggressive TCP Scan..."
nmap -A -p "$ports" "$ip" -oA "nmap_aggressive_$netid"

# Echo status and run Nmap Fast UDP Scan
echo "Performing Nmap Fast UDP Scan..."
nmap -sU -F -T4 "$ip" -oN "nmap_udp_fast_$netid"

# Echo status and run Nmap Version/Script UDP Scan
echo "Performing Nmap Version/Script UDP Scan..."
nmap -sU -sV -sC -p "$ports" "$ip" -oA "nmap_udp_details_$netid"

echo ""
echo ""
echo "*** All recon tasks have been completed ***"
